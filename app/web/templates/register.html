{% extends "_layout.html" %}
{% block content %}
<div class="auth-shell">
  <div class="card auth-card" role="main" aria-labelledby="reg-title">
    <h1 id="reg-title">Регистрация</h1>

    <form id="reg-form" onsubmit="return submitReg(event)" class="field" aria-live="polite">
      <div class="field">
        <label for="reg-email">Email</label>
        <input id="reg-email" type="email" required>
      </div>
      <div class="field">
        <label for="reg-pass">Пароль</label>
        <input id="reg-pass" type="password" minlength="8" required>
      </div>

      <div>
        <button class="btn" type="submit">Зарегистрироваться</button>
      </div>
    </form>

    <div id="reg-result" class="muted" role="status" aria-live="polite" style="margin-top:12px;"></div>

    <p class="muted" style="margin-top:12px;">Уже есть аккаунт? <a href="{{ request.url_for('login_page').path }}">Войти</a></p>
  </div>
</div>

<script>
async function submitReg(e){
  e.preventDefault();
  const email = document.getElementById('reg-email').value;
  const password = document.getElementById('reg-pass').value;
  const r = await fetch('/auth/register', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({email, password})
  });
  const node = document.getElementById('reg-result');
  if (!r.ok) {
    let txt = '';
    try { txt = await r.text(); } catch(_) { txt = r.statusText; }
    node.textContent = 'Ошибка регистрации: ' + txt;
    return false;
  }
  //const loginUrl = "{{ request.url_for('login_page') }}";
  //node.innerHTML = `Зарегистрированы. <a href="${loginUrl}">Войти</a>.`;
  node.innerHTML = `Регистрация прошла успешно. См.почту.`;
  return false;
}
</script>
{% endblock %}