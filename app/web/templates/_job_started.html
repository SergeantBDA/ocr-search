<div id="job-{{ job_id }}"
     class="toast"
     style="--pct: 0%"
     hx-get="/jobs/{{ job_id }}"
     hx-trigger="load, every 5s [document.visibilityState === 'visible']"
     hx-swap="outerHTML">
  <div class="toast-title">Обработка загруженных файлов</div>
  <div class="toast-body">
    Прогресс: <span class="pct">0%</span>
    <div class="progress"><div class="bar"></div></div>
  </div>
</div>
<script>
  // Запоминаем job_id и время старта, чтобы восстановить опрос после F5
  (function(){
    const id = "{{ job_id }}";
    const idsKey = "ocr_jobs";
    const tsKey  = "ocr_job_times";
    const ids = JSON.parse(localStorage.getItem(idsKey) || "[]");
    const times = JSON.parse(localStorage.getItem(tsKey) || "{}");
    if (!ids.includes(id)) ids.unshift(id);
    times[id] = Date.now();
    localStorage.setItem(idsKey, JSON.stringify(ids));
    localStorage.setItem(tsKey, JSON.stringify(times));
  })();
</script>

